(function(){/*
 sf2synth.js v0.3.1 | imaya / GREE Inc. / Logue | license: MIT */
'use strict';(function(r,l){"object"===typeof exports&&"object"===typeof module?module.exports=l():"function"===typeof define&&define.amd?define("SoundFont",[],l):"object"===typeof exports?exports.SoundFont=l():r.SoundFont=l()})("undefined"!==typeof self?self:this,function(){return function(r){function l(g){if(m[g])return m[g].exports;var d=m[g]={i:g,l:!1,exports:{}};r[g].call(d.exports,d,d.exports,l);d.l=!0;return d.exports}var m={};l.m=r;l.c=m;l.d=function(g,d,a){l.o(g,d)||Object.defineProperty(g,
d,{enumerable:!0,get:a})};l.r=function(g){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"});Object.defineProperty(g,"__esModule",{value:!0})};l.t=function(g,d){d&1&&(g=l(g));if(d&8||d&4&&"object"===typeof g&&g&&g.__esModule)return g;var a=Object.create(null);l.r(a);Object.defineProperty(a,"default",{enumerable:!0,value:g});if(d&2&&"string"!=typeof g)for(var b in g)l.d(a,b,function(c){return g[c]}.bind(null,b));return a};l.n=function(g){var d=
g&&g.__esModule?function(){return g["default"]}:function(){return g};l.d(d,"a",d);return d};l.o=function(g,d){return Object.prototype.hasOwnProperty.call(g,d)};l.p="";return l(l.s=5)}([function(r,l,m){m.d(l,"a",function(){return g});class g{constructor(a,b={}){this.input=a;this.ip=b.index||0;this.length=b.length||a.length-this.ip;this.offset=this.ip;this.padding=void 0!==b.padding?b.padding:!0;this.bigEndian=void 0!==b.bigEndian?b.bigEndian:!1}parse(){const a=this.length+this.offset;for(this.chunkList=
[];this.ip<a;)this.parseChunk()}parseChunk(){var a=this.input;let b=this.ip;this.chunkList.push(new d(String.fromCharCode(a[b++],a[b++],a[b++],a[b++]),a=this.bigEndian?(a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++])>>>0:(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0,b));b+=a;this.padding&&1===(b-this.offset&1)&&b++;this.ip=b}getChunk(a){a=this.chunkList[a];return void 0===a?null:a}getNumberOfChunks(){return this.chunkList.length}}class d{constructor(a,b,c){this.type=a;this.size=b;this.offset=c}}},function(r,
l,m){m.r(l);m.d(l,"Parser",function(){return d});var g=m(0);class d{constructor(a,b={}){this.input=a;this.parserOption=b.parserOption;this.sampleRate=b.sampleRate||22050;this.GeneratorEnumeratorTable=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend",
"pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay","delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",
,"scaleTuning","exclusiveClass","overridingRootKey","endOper"]}parse(){var a=new g.a(this.input,this.parserOption);a.parse();if(1!==a.chunkList.length)throw Error("wrong chunk length");a=a.getChunk(0);if(null===a)throw Error("chunk not found");this.parseRiffChunk(a);this.input=null}parseRiffChunk(a){const b=this.input;let c=a.offset;if("RIFF"!==a.type)throw Error("invalid chunk type:"+a.type);const e=String.fromCharCode(b[c++],b[c++],b[c++],b[c++]);if("sfbk"!==e)throw Error("invalid signature:"+e);
a=new g.a(b,{index:c,length:a.size-4});a.parse();if(3!==a.getNumberOfChunks())throw Error("invalid sfbk structure");this.parseInfoList(a.getChunk(0));this.parseSdtaList(a.getChunk(1));this.parsePdtaList(a.getChunk(2))}parseInfoList(a){const b=this.input;let c=a.offset;if("LIST"!==a.type)throw Error("invalid chunk type:"+a.type);const e=String.fromCharCode(b[c++],b[c++],b[c++],b[c++]);if("INFO"!==e)throw Error("invalid signature:"+e);(new g.a(b,{index:c,length:a.size-4})).parse()}parseSdtaList(a){const b=
this.input;let c=a.offset;if("LIST"!==a.type)throw Error("invalid chunk type:"+a.type);const e=String.fromCharCode(b[c++],b[c++],b[c++],b[c++]);if("sdta"!==e)throw Error("invalid signature:"+e);a=new g.a(b,{index:c,length:a.size-4});a.parse();if(1!==a.chunkList.length)throw Error("TODO");this.samplingData=a.getChunk(0)}parsePdtaList(a){const b=this.input;let c=a.offset;if("LIST"!==a.type)throw Error("invalid chunk type:"+a.type);const e=String.fromCharCode(b[c++],b[c++],b[c++],b[c++]);if("pdta"!==
e)throw Error("invalid signature:"+e);a=new g.a(b,{index:c,length:a.size-4});a.parse();if(9!==a.getNumberOfChunks())throw Error("invalid pdta chunk");this.parsePhdr(a.getChunk(0));this.parsePbag(a.getChunk(1));this.parsePmod(a.getChunk(2));this.parsePgen(a.getChunk(3));this.parseInst(a.getChunk(4));this.parseIbag(a.getChunk(5));this.parseImod(a.getChunk(6));this.parseIgen(a.getChunk(7));this.parseShdr(a.getChunk(8))}parsePhdr(a){const b=this.input;let c=a.offset;const e=this.presetHeader=[],f=a.offset+
a.size;if("phdr"!==a.type)throw Error("invalid chunk type:"+a.type);for(;c<f;)e.push({presetName:String.fromCharCode.apply(null,b.subarray(c,c+=20)),preset:b[c++]|b[c++]<<8,bank:b[c++]|b[c++]<<8,presetBagIndex:b[c++]|b[c++]<<8,library:(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0,genre:(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0,morphology:(b[c++]|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0})}parsePbag(a){const b=this.input;let c=a.offset;const e=this.presetZone=[],f=a.offset+a.size;if("pbag"!==a.type)throw Error("invalid chunk type:"+
a.type);for(;c<f;)e.push({presetGeneratorIndex:b[c++]|b[c++]<<8,presetModulatorIndex:b[c++]|b[c++]<<8})}parsePmod(a){if("pmod"!==a.type)throw Error("invalid chunk type:"+a.type);this.presetZoneModulator=this.parseModulator(a)}parsePgen(a){if("pgen"!==a.type)throw Error("invalid chunk type:"+a.type);this.presetZoneGenerator=this.parseGenerator(a)}parseInst(a){const b=this.input;let c=a.offset;const e=this.instrument=[],f=a.offset+a.size;if("inst"!==a.type)throw Error("invalid chunk type:"+a.type);
for(;c<f;)e.push({instrumentName:String.fromCharCode.apply(null,b.subarray(c,c+=20)),instrumentBagIndex:b[c++]|b[c++]<<8})}parseIbag(a){const b=this.input;let c=a.offset;const e=this.instrumentZone=[],f=a.offset+a.size;if("ibag"!==a.type)throw Error("invalid chunk type:"+a.type);for(;c<f;)e.push({instrumentGeneratorIndex:b[c++]|b[c++]<<8,instrumentModulatorIndex:b[c++]|b[c++]<<8})}parseImod(a){if("imod"!==a.type)throw Error("invalid chunk type:"+a.type);this.instrumentZoneModulator=this.parseModulator(a)}parseIgen(a){if("igen"!==
a.type)throw Error("invalid chunk type:"+a.type);this.instrumentZoneGenerator=this.parseGenerator(a)}parseShdr(a){const b=this.input;let c=a.offset;const e=this.sample=[],f=this.sampleHeader=[],h=a.offset+a.size;let d,p,k,n,g,l,q,u,w;if("shdr"!==a.type)throw Error("invalid chunk type:"+a.type);for(;c<h;){a=String.fromCharCode.apply(null,b.subarray(c,c+=20));d=(b[c++]<<0|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;p=(b[c++]<<0|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;k=(b[c++]<<0|b[c++]<<8|b[c++]<<16|b[c++]<<
24)>>>0;n=(b[c++]<<0|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;g=(b[c++]<<0|b[c++]<<8|b[c++]<<16|b[c++]<<24)>>>0;l=b[c++];q=b[c++]<<24>>24;u=b[c++]|b[c++]<<8;w=b[c++]|b[c++]<<8;let h=new Int16Array((new Uint8Array(b.subarray(this.samplingData.offset+2*d,this.samplingData.offset+2*p))).buffer);k-=d;n-=d;if(0<g){const c=this.adjustSampleData(h,g);h=c.sample;g*=c.multiply;k*=c.multiply;n*=c.multiply}e.push(h);f.push({sampleName:a,start:d,end:p,startLoop:k,endLoop:n,sampleRate:g,originalPitch:l,pitchCorrection:q,
sampleLink:u,sampleType:w})}}adjustSampleData(a,b){let c,e,f,h,d=1;for(;b<this.sampleRate;){c=new Int16Array(2*a.length);e=h=0;for(f=a.length;e<f;++e)c[h++]=a[e],c[h++]=a[e];a=c;d*=2;b*=2}return{sample:a,multiply:d}}parseModulator(a){const b=this.input;let c=a.offset;a=a.offset+a.size;let e,f;const h=[];for(;c<a;){c+=2;e=b[c++]|b[c++]<<8;f=this.GeneratorEnumeratorTable[e];if(void 0===f)h.push({type:f,value:{code:e,amount:b[c]|b[c+1]<<8<<16>>16,lo:b[c++],hi:b[c++]}});else switch(f){case "keyRange":case "velRange":case "keynum":case "velocity":h.push({type:f,
value:{lo:b[c++],hi:b[c++]}});break;default:h.push({type:f,value:{amount:b[c++]|b[c++]<<8<<16>>16}})}c+=2;c+=2}return h}parseGenerator(a){const b=this.input;let c=a.offset;a=a.offset+a.size;let e,f;const h=[];for(;c<a;)if(e=b[c++]|b[c++]<<8,f=this.GeneratorEnumeratorTable[e],void 0===f)h.push({type:f,value:{code:e,amount:b[c]|b[c+1]<<8<<16>>16,lo:b[c++],hi:b[c++]}});else switch(f){case "keynum":case "keyRange":case "velRange":case "velocity":h.push({type:f,value:{lo:b[c++],hi:b[c++]}});break;default:h.push({type:f,
value:{amount:b[c++]|b[c++]<<8<<16>>16}})}return h}createInstrument(){const a=this.instrument,b=this.instrumentZone,c=[];let e,f,h,d,p;h=0;for(d=a.length;h<d;++h){var k=a[h].instrumentBagIndex;var n=a[h+1]?a[h+1].instrumentBagIndex:b.length;e=[];for(p=n;k<p;++k)n=this.createInstrumentGenerator_(b,k),f=this.createInstrumentModulator_(b,k),e.push({generator:n.generator,generatorSequence:n.generatorInfo,modulator:f.modulator,modulatorSequence:f.modulatorInfo});c.push({name:a[h].instrumentName,info:e})}return c}createPreset(){const a=
this.presetHeader,b=this.presetZone,c=[];let e;let f,h,d;h=0;for(d=a.length;h<d;++h){var p=a[h].presetBagIndex;var k=a[h+1]?a[h+1].presetBagIndex:b.length;for(e=[];p<k;++p){var n=this.createPresetGenerator_(b,p);f=this.createPresetModulator_(b,p);e.push({generator:n.generator,generatorSequence:n.generatorInfo,modulator:f.modulator,modulatorSequence:f.modulatorInfo});n=void 0!==n.generator.instrument?n.generator.instrument.amount:void 0!==f.modulator.instrument?f.modulator.instrument.amount:null}c.push({name:a[h].presetName,
info:e,header:a[h],instrument:n})}return c}createInstrumentGenerator_(a,b){a=this.createBagModGen_(a,a[b].instrumentGeneratorIndex,a[b+1]?a[b+1].instrumentGeneratorIndex:this.instrumentZoneGenerator.length,this.instrumentZoneGenerator);return{generator:a.modgen,generatorInfo:a.modgenInfo}}createInstrumentModulator_(a,b){a=this.createBagModGen_(a,a[b].presetModulatorIndex,a[b+1]?a[b+1].instrumentModulatorIndex:this.instrumentZoneModulator.length,this.instrumentZoneModulator);return{modulator:a.modgen,
modulatorInfo:a.modgenInfo}}createPresetGenerator_(a,b){a=this.createBagModGen_(a,a[b].presetGeneratorIndex,a[b+1]?a[b+1].presetGeneratorIndex:this.presetZoneGenerator.length,this.presetZoneGenerator);return{generator:a.modgen,generatorInfo:a.modgenInfo}}createPresetModulator_(a,b){a=this.createBagModGen_(a,a[b].presetModulatorIndex,a[b+1]?a[b+1].presetModulatorIndex:this.presetZoneModulator.length,this.presetZoneModulator);return{modulator:a.modgen,modulatorInfo:a.modgenInfo}}createBagModGen_(a,
b,c,e){a=[];const f={unknown:[],keyRange:{hi:127,lo:0}};let h;for(h=b;h<c;++h)b=e[h],a.push(b),"unknown"===b.type?f.unknown.push(b.value):f[b.type]=b.value;return{modgen:f,modgenInfo:a}}}l["default"]=d},function(r,l,m){m.r(l);class g{constructor(d,a={}){this.ctx=d;this.wetGainNode=this.ctx.createGain();this.dryGainNode=this.ctx.createGain();this.node=this.ctx.createConvolver();this.filterNode=this.ctx.createBiquadFilter();this._freq=a.freq||440;this._decay=a.decay||1;this._delay=a.delay||.5;this._filterType=
a.filterType||"bandpass";this._mix=a.mix||.5;this._reverse=a.reverse||!1;this._time=a.time||1;this.mix(this._mix);this.filterType(this._filterType);this.freq(this._freq);this.buildImpulse();this.node.connect(this.dryGainNode);this.node.connect(this.wetGainNode);this.node.connect(this.filterNode);this.dryGainNode.connect(this.node);this.wetGainNode.connect(this.node);this.filterNode.connect(this.node)}buildImpulse(){var d=this.ctx.sampleRate;const a=Math.max(d*this._time,1),b=d*this._delay;d=this.ctx.createBuffer(2,
a,d);const c=new Float32Array(a),e=new Float32Array(a);for(let h=0;h<a;h++){if(h<b)c[h]=0,e[h]=0;else{var f=this._reverse?a-h:h;f=Math.pow(1-f/a,this._decay);c[h]=(2*Math.random()-1)*f;e[h]=(2*Math.random()-1)*f}f=this._reverse?a-(h-b):h-b;f=Math.pow(1-f/a,this._decay);c[h]=(2*Math.random()-1)*f;e[h]=(2*Math.random()-1)*f}d.getChannelData(0).set(c);d.getChannelData(1).set(e);this.node.buffer=d}mix(d){this._mix=d;this.dryGainNode.gain.setTargetAtTime(this.getDryLevel(d)/127,this.ctx.currentTime,.015);
this.wetGainNode.gain.setTargetAtTime(this.getWetLevel(d)/127,this.ctx.currentTime,.015)}time(d){this._time=d;this.buildImpulse()}decay(d){this._decay=d;this.buildImpulse()}delay(d){this._delay=d;this.buildImpulse()}reverse(d){this._reverse=d;this.buildImpulse()}freq(d){this._freq=d;this.filterNode.frequency.setTargetAtTime(this._freq,this.ctx.currentTime,.015)}filterType(d){this.filterNode.type=this._filterType=d}getDryLevel(d){return 1<d||0>d?0:.5>=d?1:1-2*(d-.5)}getWetLevel(d){return 1<d||0>d?
0:.5<=d?1:1-2*(d-.5)}}l["default"]=g},function(r,l,m){var g=m(4),d=m(1),a=m(2);class b{constructor(c){let b;this.input=c;this.parser={};this.bank=0;this.bankSet={};this.bufferSize=2048;this.ctx=this.getAudioContext();this.gainMaster=this.ctx.createGain();this.bufSrc=this.ctx.createBufferSource();this.channelInstrument=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.channelBank=[0,0,0,0,0,0,0,0,0,0,0,127,0,0,0,0];this.channelVolume=[127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127];this.channelPanpot=
[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.channelPitchBend=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.channelPitchBendSensitivity=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2];this.channelExpression=[127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127];this.channelAttack=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.channelDecay=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.channelSustin=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.channelRelease=[64,64,64,64,
64,64,64,64,64,64,64,64,64,64,64,64];this.channelHold=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];this.channelReverbDepth=[40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40];this.channelHarmonicContent=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.channelCutOffFrequency=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.isXG=this.isGS=!1;this.programSet=[];this.channelMute=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];this.currentNoteOn=[[],[],[],[],[],[],[],[],[],[],[],[],[],
[],[],[]];this.baseVolume=1/65535;this.masterVolume=16384;this.percussionPart=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!1,!1,!1,!1,!1,!1];this.percussionVolume=Array(128);c=0;for(b=this.percussionVolume.length;c<b;++c)this.percussionVolume[c]=127;this.programSet={};this.useReverb=!0;this.reverb=new a["default"](this.ctx)}getAudioContext(){const c=new (window.AudioContext||window.webkitAudioContext);c.createGain=c.createGain||c.createGainNode;if("suspended"===c.state){const a=["touchstart","touchend","mousedown",
"keydown"],b=()=>{a.forEach(c=>{document.body.removeEventListener(c,b)});this.playSilent();c.resume()};a.forEach(c=>{document.body.addEventListener(c,b,!1)})}return c}playSilent(){const c=this.ctx.createBuffer(1,1,22050),a=this.ctx.createBufferSource();a.buffer=c;a.connect(this.ctx.destination);a.start(0)}init(c="GM"){this.parser=new d["default"](this.input,{sampleRate:this.ctx.sampleRate});this.bankSet=this.createAllInstruments();this.isGS=this.isXG=!1;"XG"==c?this.isXG=!0:"GS"==c&&(this.isGS=!0);
for(c=0;16>c;++c)this.programChange(c,0),this.volumeChange(c,100),this.panpotChange(c,64),this.pitchBend(c,0,64),this.pitchBendSensitivity(c,2),this.channelHold[c]=!1,this.channelExpression[c]=127,this.channelBank[c]=9===c?127:0,this.attackTime(c,64),this.decayTime(c,64),this.sustinTime(c,64),this.releaseTime(c,64),this.harmonicContent(c,64),this.cutOffFrequency(c,64),this.reverbDepth(c,40),this.updateBankSelect(c),this.updateProgramSelect(c);this.setPercussionPart(9,!0);for(c=0;128>c;++c)this.percussionVolume[c]=
127;this.useReverb&&(this.reverb.node.disconnect(0),this.gainMaster.connect(this.reverb.node),this.reverb.node.connect(this.ctx.destination))}close(){this.ctx.close()}refreshInstruments(c){this.input=c;this.parser=new d["default"](c);this.bankSet=this.createAllInstruments()}createAllInstruments(){const c=this.parser;c.parse();const a=c.createPreset(),b=c.createInstrument(),d=[];let t,p,k,n,g,l,q,u;const w=[];n=0;for(g=a.length;n<g;++n){var v=a[n];k=v.header.preset;t=v.header.bank;u=v.name.replace(/\0*$/,
"");if("number"===typeof v.instrument&&(p=b[v.instrument],"EOI"!==p.name.replace(/\0*$/,""))){void 0===d[t]&&(d[t]=[]);v=d[t];v[k]={};v[k].name=u;l=0;for(q=p.info.length;l<q;++l)this.createNoteInfo(c,p.info[l],v[k]);w[t]||(w[t]={});w[t][k]=u}}this.programSet=w;return d}createNoteInfo(c,a,b){a=a.generator;if(void 0!==a.keyRange&&void 0!==a.sampleID){var e=this.getModGenAmount(a,"delayVolEnv",-12E3),f=this.getModGenAmount(a,"attackVolEnv",-12E3),d=this.getModGenAmount(a,"holdVolEnv",-12E3),k=this.getModGenAmount(a,
"decayVolEnv",-12E3),g=this.getModGenAmount(a,"sustainVolEnv"),l=this.getModGenAmount(a,"releaseVolEnv",-12E3),m=this.getModGenAmount(a,"delayModEnv",-12E3),q=this.getModGenAmount(a,"attackModEnv",-12E3),u=this.getModGenAmount(a,"holdModEnv",-12E3),w=this.getModGenAmount(a,"decayModEnv",-12E3),v=this.getModGenAmount(a,"sustainModEnv"),z=this.getModGenAmount(a,"releaseModEnv",-12E3),r=this.getModGenAmount(a,"scaleTuning",100)/100,x=this.getModGenAmount(a,"freqVibLFO"),y=this.getModGenAmount(a,"pan"),
A=this.getModGenAmount(a,"coarseTune")+this.getModGenAmount(a,"fineTune")/100;for(let h=a.keyRange.lo,t=a.keyRange.hi;h<=t;++h){if(b[h])continue;const t=this.getModGenAmount(a,"sampleID"),p=c.sampleHeader[t];b[h]={sample:c.sample[t],sampleRate:p.sampleRate,sampleModes:this.getModGenAmount(a,"sampleModes"),basePlaybackRate:Math.pow(Math.pow(2,1/12),(h-this.getModGenAmount(a,"overridingRootKey",p.originalPitch)+A+p.pitchCorrection/100)*r),modEnvToPitch:this.getModGenAmount(a,"modEnvToPitch")/100,scaleTuning:r,
start:32768*this.getModGenAmount(a,"startAddrsCoarseOffset")+this.getModGenAmount(a,"startAddrsOffset"),end:32768*this.getModGenAmount(a,"endAddrsCoarseOffset")+this.getModGenAmount(a,"endAddrsOffset"),loopStart:p.startLoop+32768*this.getModGenAmount(a,"startloopAddrsCoarseOffset")+this.getModGenAmount(a,"startloopAddrsOffset"),loopEnd:p.endLoop+32768*this.getModGenAmount(a,"endloopAddrsCoarseOffset")+this.getModGenAmount(a,"endloopAddrsOffset"),volDelay:Math.pow(2,e/1200),volAttack:Math.pow(2,f/
1200),volHold:Math.pow(2,d/1200)*Math.pow(2,(60-h)*this.getModGenAmount(a,"keynumToVolEnvHold")/1200),volDecay:Math.pow(2,k/1200)*Math.pow(2,(60-h)*this.getModGenAmount(a,"keynumToVolEnvDecay")/1200),volSustain:g/1E3,volRelease:Math.pow(2,l/1200),modDelay:Math.pow(2,m/1200),modAttack:Math.pow(2,q/1200),modHold:Math.pow(2,u/1200)*Math.pow(2,(60-h)*this.getModGenAmount(a,"keynumToModEnvHold")/1200),modDecay:Math.pow(2,w/1200)*Math.pow(2,(60-h)*this.getModGenAmount(a,"keynumToModEnvDecay")/1200),modSustain:v/
1E3,modRelease:Math.pow(2,z/1200),initialFilterFc:this.getModGenAmount(a,"initialFilterFc",13500),modEnvToFilterFc:this.getModGenAmount(a,"modEnvToFilterFc"),initialFilterQ:this.getModGenAmount(a,"initialFilterQ"),reverbEffectSend:this.getModGenAmount(a,"reverbEffectSend"),initialAttenuation:this.getModGenAmount(a,"initialAttenuation"),freqVibLFO:x?8.176*Math.pow(2,x/1200):void 0,pan:y?y/1200:void 0}}}}getModGenAmount(c,a,b){void 0===b&&(b=0);return c[a]?c[a].amount:b}start(){this.connect();this.bufSrc.start(0);
this.setMasterVolume(16383)}setMasterVolume(c){this.masterVolume=c;this.gainMaster.gain.setTargetAtTime(c/16384*this.baseVolume,this.ctx.currentTime,.015)}connect(){this.bufSrc.connect(this.gainMaster);this.gainMaster.connect(this.ctx.destination);this.useReverb&&(this.gainMaster.connect(this.reverb.node),this.reverb.node.connect(this.ctx.destination))}disconnect(){this.bufSrc.disconnect(0);this.gainMaster.disconnect(0);this.useReverb&&this.reverb.node.disconnect(0);this.bufSrc.buffer=null}setReverb(c){(this.useReverb=
c)?(this.gainMaster.connect(this.reverb.node),this.reverb.node.connect(this.ctx.destination)):this.reverb.node.disconnect(0)}drawSynth(){const c=window.document,a=this.element=c.createElement("div"),b=c.createElement("div");b.className="instrument";const d="mute bank program volume panpot pitchBend pitchBendSensitivity keys".split(" "),t="ontouchstart"in window?"touchstart":"mousedown",p="ontouchend"in window?"touchend":"mouseup";for(let a=0;16>a;a++){const e=c.createElement("div");e.className="channel";
for(const b in d)if({}.hasOwnProperty.call(d,b)){const f=c.createElement("div");f.className=d[b];switch(d[b]){case "mute":var k=c.createElement("div");k.className="custom-control custom-checkbox custom-control-inline";var g=c.createElement("input");g.setAttribute("type","checkbox");g.className="custom-control-input";g.id="mute"+a+"ch";g.addEventListener("change",((c,a)=>()=>{c.mute(a,this.checked)})(this,a),!1);k.appendChild(g);g=c.createElement("label");g.className="custom-control-label";g.textContent=
a+1;g.setAttribute("for","mute"+a+"ch");k.appendChild(g);f.appendChild(k);break;case "bank":k=c.createElement("select");k.className="form-control form-control-sm";f.appendChild(k);g=c.createElement("option");k.appendChild(g);k.addEventListener("change",((c,a)=>b=>{c.bankChange(a,b.target.value);c.programChange(a,c.channelElemInstrument[a])})(this,a),!1);k.selectedIndex=this.channelBank[b];break;case "program":k=c.createElement("select");k.className="form-control form-control-sm";f.appendChild(k);
k.addEventListener("change",((c,a)=>b=>{c.programChange(a,b.target.value)})(this,a),!1);k.selectedIndex=this.channelInstrument[b];break;case "volume":f.innerText=100;case "pitchBendSensitivity":f.innerText=2;break;case "panpot":k=c.createElement("meter");k.min=0;k.max=127;k.value=64;f.appendChild(k);break;case "pitchBend":k=c.createElement("meter");k.min=-8192;k.max=8192;k.value=0;f.appendChild(k);break;case "keys":for(k=0;127>k;k++)g=c.createElement("div"),g.className="key "+([1,3,6,8,10].includes(k%
12)?"semitone":"tone"),f.appendChild(g),g.addEventListener(t,((c,a,b)=>e=>{e.preventDefault();c.drag=!0;c.noteOn(a,b,127)})(this,a,k)),g.addEventListener("mouseover",((c,a,b)=>e=>{e.preventDefault();c.drag&&c.noteOn(a,b,127)})(this,a,k)),g.addEventListener("mouseout",((c,a,b)=>e=>{e.preventDefault();c.noteOff(a,b,0)})(this,a,k)),g.addEventListener(p,((c,a,b)=>e=>{e.preventDefault();c.drag=!1;c.noteOff(a,b,0)})(this,a,k))}e.appendChild(f)}b.appendChild(e)}a.appendChild(b);return a}updateSynthElement(c,
a,b){this.element&&(c=this.element.querySelector(".instrument > .channel:nth-child("+(c+1)+") .key:nth-child("+(a+1)+")"),0===b?(c.classList.remove("note-on"),c.style.opacity=1):(c.classList.add("note-on"),c.style.opacity=(b/127).toFixed(2)))}updateBankSelect(c){if(this.element){for(c=this.element.querySelector(".instrument > .channel:nth-child("+(c+1)+") .bank > select");c.firstChild;)c.removeChild(c.firstChild);for(const a in this.programSet)if({}.hasOwnProperty.call(this.programSet,a)){const b=
document.createElement("option");b.value=a;b.textContent=("000"+parseInt(a)).slice(-3);c.appendChild(b)}}}updateProgramSelect(c){if(this.element){var a=this.channelBank[c],b=this.element.querySelector(".instrument > .channel:nth-child("+(c+1)+") .bank > select"),d=this.element.querySelector(".instrument > .channel:nth-child("+(c+1)+") .program > select");for(b.value=this.channelBank[c];d.firstChild;)d.removeChild(d.firstChild);for(const e in this.programSet[a])({}).hasOwnProperty.call(this.programSet[a],
e)&&(b=document.createElement("option"),b.value=e,b.textContent=("000"+(parseInt(e)+1)).slice(-3)+":"+this.programSet[a][e],e===this.channelInstrument[c]&&(b.selected="selected"),d.appendChild(b))}}noteOn(c,a,b){var e=this.channelBank[c],d="object"===typeof this.bankSet[e]?this.bankSet[e]:this.bankSet[0];d="object"===typeof d[this.channelInstrument[c]]?d[this.channelInstrument[c]]:1==this.percussionPart[c]?this.bankSet[this.isXG?127:128][0]:this.bankSet[0][this.channelInstrument[c]];if(void 0===d[a])console.warn("instrument not found: bank=%s instrument=%s channel=%s key=%s",
e,this.channelInstrument[c],c,a);else{var f=d[a],k=this.channelPanpot[c]-64;f.channel=c;f.key=a;f.velocity=b;f.panpot=k/(0>k?64:63);f.volume=this.channelVolume[c]/127;f.pitchBend=this.channelPitchBend[c]-8192;f.expression=this.channelExpression[c];f.pitchBendSensitivity=Math.round(this.channelPitchBendSensitivity[c]);f.mute=this.channelMute[c];f.releaseTime=this.channelRelease[c];f.cutOffFrequency=this.cutOffFrequency[c];f.harmonicContent=this.harmonicContent[c];125<e&&(42!==a&&44!==a||this.noteOff(c,
46,0),80===a&&this.noteOff(c,81,0),d.volume*=this.percussionVolume[a]/127);e=new g.a(this.ctx,this.gainMaster,f);e.noteOn();this.currentNoteOn[c].push(e);this.updateSynthElement(c,a,b)}}noteOff(c,a,b){let e;const d=this.currentNoteOn[c];let f;const g=this.channelHold[c];b=0;for(e=d.length;b<e;++b)f=d[b],f.key===a&&(f.noteOff(),g||(f.release(),d.splice(b,1),--b,--e));this.updateSynthElement(c,a,0)}hold(c,a){var b=this.currentNoteOn[c];let e,d;if(!(this.channelHold[c]=!(64>a)))for(e=0,d=b.length;e<
d;++e)a=b[e],a.isNoteOff()&&(a.release(),b.splice(e,1),--e,--d);this.element&&(b=this.element.querySelector(".instrument > .channel:nth-child("+(c+1)+")"),this.channelHold[c]?b.classList.add("hold"):b.classList.remove("hold"))}bankSelectMsb(a,b){if(this.isXG)if(this.channelBank[a]=0,64===b)this.channelBank[a]=125,this.percussionPart[a]=!0;else{if(126===b||127===b)this.channelBank[a]=b,this.percussionPart[a]=!0}else if(this.isGS)this.channelBank[a]=9===a?128:b,this.percussionPart[a]=128===b;else return;
this.updateBankSelect(a)}bankSelectLsb(a,b){this.isXG&&!0!==this.percussionPart[a]&&(this.percussionPart[a]=125<=b,this.channelBank[a]=b,this.updateBankSelect(a))}programChange(a,b){this.channelInstrument[a]=b;this.bankChange(a,this.channelBank[a]);this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(a+1)+") .program > select").value=b)}bankChange(a,b){this.channelBank[a]="object"===typeof this.bankSet[b]?b:this.percussionPart[a]?this.isXG?127:128:0;this.updateProgramSelect(a);
this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(a+1)+") > .bank > select").value=b)}volumeChange(a,b){this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(a+1)+") > .volume").innerText=b);this.channelVolume[a]=b}expression(a,b){let c,e;const d=this.currentNoteOn[a];c=0;for(e=d.length;c<e;++c)d[c].updateExpression(b);this.channelExpression[a]=b}panpotChange(a,b){this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(a+
1)+") > .panpot > meter").value=b);this.channelPanpot[a]=b}pitchBend(a,b,d){b=b&127|(d&127)<<7;let c;const e=this.currentNoteOn[a],f=b-8192;this.element&&(this.element.querySelector(".instrument > .channel:nth-child("+(a+1)+") > .pitchBend > meter").value=f);d=0;for(c=e.length;d<c;++d)e[d].updatePitchBend(f);this.channelPitchBend[a]=b}pitchBendSensitivity(a,b){this.element&&(document.querySelector(".instrument > .channel:nth-child("+(a+1)+") > .pitchBendSensitivity").innerText=b);this.channelPitchBendSensitivity[a]=
b}attackTime(a,b){this.channelAttack[a]=b}decayTime(a,b){this.channelDecay[a]=b}sustinTime(a,b){this.channelSustin[a]=b}releaseTime(a,b){this.channelRelease[a]=b}harmonicContent(a,b){this.channelHarmonicContent[a]=b}cutOffFrequency(a,b){this.channelCutOffFrequency[a]=b}reverbDepth(a,b){this.reverbDepth[a]=b}getPitchBendSensitivity(a){return this.channelPitchBendSensitivity[a]}drumInstrumentLevel(a,b){this.percussionVolume[a]=b}allNoteOff(a){const b=this.currentNoteOn[a];for(this.hold(a,0);0<b.length;)this.noteOff(a,
b[0].key,0)}allSoundOff(a){const b=this.currentNoteOn[a];let c;for(;0<b.length;)c=b.shift(),this.noteOff(a,c.key,0),c.release(),c.disconnect();this.hold(a,0)}resetAllControl(a){this.allNoteOff(a);this.expression(a,127);this.pitchBend(a,0,64)}mute(a,b){const c=this.currentNoteOn[a];if(this.channelMute[a]=b)for(a=0,b=c.length;a<b;++a)c[a].disconnect();else for(a=0,b=c.length;a<b;++a)c[a].connect()}setPercussionPart(a,b){this.channelBank[a]=this.isXG?127:128;this.percussionPart[a]=b}}l.a=b},function(r,
l,m){class g{constructor(d,a,b){this.ctx=d;this.destination=a;this.instrument=b;this.channel=b.channel;this.key=b.key;this.velocity=b.velocity;this.buffer=b.sample;this.playbackRate=b.basePlaybackRate;this.loopStart=b.loopStart;this.loopEnd=b.loopEnd;this.sampleRate=b.sampleRate;this.volume=b.volume;this.panpot=b.panpot;this.pitchBend=b.pitchBend;this.pitchBendSensitivity=b.pitchBendSensitivity;this.modEnvToPitch=b.modEnvToPitch;this.expression=b.expression;this.cutOffFrequency=b.cutOffFrequency;
this.hermonicContent=b.hermonicContent;this.startTime=d.currentTime;this.computedPlaybackRate=this.playbackRate|0;this.noteOffState=!1}noteOn(){var d=this.ctx;const a=this.instrument;var b=this.buffer;const c=this.ctx.currentTime;var e=c+a.volDelay;const f=c+a.modDelay;var h=e+a.volAttack+a.volHold;const g=e+a.modAttack+a.modHold;var l=h+a.volDecay;const k=g+a.modDecay;var n=a.loopStart/this.sampleRate,m=a.loopEnd/this.sampleRate;const r=a.start/this.sampleRate;var q=void 0!==a.pan?a.pan:this.panpot;
b=b.subarray(0,b.length+a.end);var u=this.audioBuffer=d.createBuffer(1,b.length,this.sampleRate);u.getChannelData(0).set(b);b=this.bufferSource=d.createBufferSource();b.buffer=u;b.loop=a.sampleModes;b.loopStart=n;b.loopEnd=m;this.updatePitchBend(this.pitchBend);n=this.gainOutput=d.createGain();u=n.gain;this.expressionGain=d.createGain();this.expressionGain.gain.setTargetAtTime(this.expression/127,this.ctx.currentTime,.015);m=this.panner=d.createPanner();m.panningModel="equalpower";m.setPosition(Math.sin(q*
Math.PI/2),0,Math.cos(q*Math.PI/2));q=this.velocity/127*this.volume*(1-a.initialAttenuation/1E3);0>q&&(q=0);u.setValueAtTime(0,c).setValueAtTime(0,e).setTargetAtTime(q,e,a.volAttack).setValueAtTime(q,h).linearRampToValueAtTime(q*(1-a.volSustain),l);e=this.amountToFreq(a.initialFilterFc);h=this.amountToFreq(a.initialFilterFc+a.modEnvToFilterFc);l=e+(h-e)*(1-a.modSustain);d=this.modulator=d.createBiquadFilter();d.Q.setValueAtTime(Math.pow(10,a.initialFilterQ/200),c);d.frequency.setTargetAtTime(e/127,
this.ctx.currentTime,.5);d.type="lowpass";d.frequency.setValueAtTime(e,c).setValueAtTime(e,f).setTargetAtTime(h,f,parseFloat(a.modAttack+1)).setValueAtTime(h,g).linearRampToValueAtTime(l,k);b.connect(d);d.connect(m);m.connect(this.expressionGain);this.expressionGain.connect(n);a.mute||this.connect();b.start(0,r)}amountToFreq(d){return 440*Math.pow(2,(d-6900)/1200)}noteOff(){this.noteOffState=!0}isNoteOff(){return this.noteOffState}release(){const d=this.instrument,a=this.bufferSource,b=this.gainOutput,
c=this.ctx.currentTime;var e=d.releaseTime-64;e=c+d.volRelease*b.gain.value*(1+e/(0>e?64:63));const f=this.modulator,h=this.amountToFreq(d.initialFilterFc);var g=this.amountToFreq(d.initialFilterFc+d.modEnvToFilterFc);g=c+d.modRelease*(h===g?1:(f.frequency.value-h)/(g-h));if(this.audioBuffer)switch(d.sampleModes){case 1:b.gain.cancelScheduledValues(0);b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(0,e);f.frequency.cancelScheduledValues(0);f.frequency.setValueAtTime(f.frequency.value,
c);f.frequency.linearRampToValueAtTime(h,g);a.playbackRate.cancelScheduledValues(0);a.playbackRate.setValueAtTime(a.playbackRate.value,c);a.playbackRate.linearRampToValueAtTime(this.computedPlaybackRate,g);a.stop(e);break;case 2:console.log("detect unused sampleModes");break;case 3:a.loop=!1,a.disconnect(),a.buffer=null}}connect(){this.gainOutput.connect(this.destination)}disconnect(){this.gainOutput.disconnect(0)}schedulePlaybackRate(){const d=this.bufferSource.playbackRate,a=this.computedPlaybackRate,
b=this.startTime,c=this.instrument,e=b+c.modAttack,f=e+c.modDecay,g=a*Math.pow(Math.pow(2,1/12),this.modEnvToPitch*this.instrument.scaleTuning);d.cancelScheduledValues(0);d.setValueAtTime(a,b);d.linearRampToValueAtTime(g,e);d.linearRampToValueAtTime(a+(g-a)*(1-c.modSustain),f)}updateExpression(d){this.expressionGain.gain.setTargetAtTime((this.expression=d)/127,this.ctx.currentTime,.015)}updatePitchBend(d){this.computedPlaybackRate=this.playbackRate*Math.pow(Math.pow(2,1/12),d/(0>d?8192:8191)*this.pitchBendSensitivity*
this.instrument.scaleTuning);this.schedulePlaybackRate()}}l.a=g},function(r,l,m){m.r(l);m.d(l,"WebMidiLink",function(){return d});var g=m(3);class d{constructor(a={}){this.NrpnMsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.NrpnLsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.RpnMsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.RpnLsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.ready=!1;this.loadCallback=()=>{};this.messageHandler=this.onmessage.bind(this);this.rpnMode=!0;this.option=a||{};this.disableDrawSynth=void 0!==
a.disableDrawSynth;this.cache=void 0!==a.cache;this.placeholder=void 0!==a.placeholder?document.getElementById(a.placeholder):window.document.body;window.addEventListener("DOMContentLoaded",function(){this.ready=!0}.bind(this),!1)}setup(a){const b=window;this.ready?this.load(a):b.addEventListener("DOMContentLoaded",function e(){b.removeEventListener("DOMContentLoaded",e,!1);this.load(a)}.bind(this),!1);b.opener?this.opener=b.opener:b.parent!==b&&(this.opener=b.parent)}load(a){const b=window.opener?
window.opener:window.parent,c=this,d=this.placeholder.appendChild(document.createElement("progress")),f=d.parentNode.insertBefore(document.createElement("output"),d.nextElementSibling);b.postMessage("link,progress","*");const g=a=>{console.info("ready");c.placeholder.removeChild(d);c.placeholder.removeChild(f);c.onload(a);"function"===typeof c.loadCallback&&c.loadCallback(a);b.postMessage("link,ready","*")};window.caches?window.caches.open("wml").then(b=>{b.match(a).then(a=>{console.info("Fetch Soundfont from cache.");
a.arrayBuffer().then(a=>{g(a)}).catch(a=>{console.err(a)})}).catch(()=>{fetch(a).then(c=>{if(!c.ok)throw Error("Network response was not ok.");b.put(a,c);console.info("Save Soundfont to cache.");c.arrayBuffer().then(a=>{g(a)}).catch(a=>console.err(a))}).catch(a=>alert("There has been a problem with your fetch operation: "+a.message))})}):(console.info("This server/client does not cache function."),fetch(a).then(a=>{const c=a.headers.get("content-length");d.max=c;const e=a.body.getReader();let h=0;
const l=[],m=a=>{if(a.done){a=0;for(var k=0;k<l.length;++k)a+=l[k].byteLength;a=new Uint8Array(a);k=0;for(let b=0;b<l.length;++b)a.set(new Uint8Array(l[b]),k),k+=l[b].byteLength;a=a.buffer;g(a)}else return h+=a.value.length,l.push(a.value),d.value=h,f.innerText=Math.round(h/c*100)+" %",b.postMessage("link,progress,"+h+","+c,"*"),e.read().then(m)};e.read().then(m)}).catch(a=>alert("There has been a problem with your fetch operation: "+a.message)))}setReverb(a){this.synth.setReverb(a)}onload(a){a=new Uint8Array(a);
this.loadSoundFont(a)}loadSoundFont(a){let b;const c=window;this.synth?(b=this.synth,b.refreshInstruments(a)):(b=this.synth=new g.a(a),this.disableDrawSynth||this.placeholder.appendChild(b.drawSynth()),b.init(),b.start(),c.addEventListener("message",this.messageHandler,!1));c.postMessage("link,ready","*")}onmessage(a){var b="function"===typeof a.data.split?a.data.split(","):[];const c=b!==[]?b.shift():"";a=window.opener?window.opener:window.parent;switch(c){case "midi":this.processMidiMessage(b.map(a=>
parseInt(a,16)));break;case "link":if(void 0!==a)switch(b=b.shift(),b){case "reqpatch":a.postMessage("link,patch","*");break;case "setpatch":case "ready":a.postMessage("link,ready","*");break;case "progress":a.postMessage("link,progress","*");break;default:console.error("unknown link message:",b)}}}setLoadCallback(a){this.loadCallback=a}processMidiMessage(a){var b=a[0]&15;const c=this.synth;switch(a[0]&240){case 128:c.noteOff(b,a[1],a[2]);break;case 144:0<a[2]?c.noteOn(b,a[1],a[2]):c.noteOff(b,a[1],
0);break;case 176:const d=a[2];switch(a[1]){case 0:c.bankSelectMsb(b,d);break;case 6:if(this.rpnMode)switch(this.RpnMsb[b]){case 0:switch(this.RpnLsb[b]){case 0:c.pitchBendSensitivity(b,d)}}else switch(this.NrpnMsb[b]){case 26:c.drumInstrumentLevel(this.NrpnLsb[b],d)}break;case 38:if(this.rpnMode)switch(this.RpnMsb[b]){case 0:switch(this.RpnLsb[b]){case 0:c.pitchBendSensitivity(b,c.getPitchBendSensitivity(b)+d/100)}}break;case 7:c.volumeChange(b,d);break;case 10:c.panpotChange(b,d);break;case 120:c.allSoundOff(b);
break;case 121:c.resetAllControl(b);break;case 32:c.bankSelectLsb(b,d);break;case 71:c.harmonicContent(b,d);break;case 98:this.rpnMode=!1;this.NrpnLsb[b]=d;break;case 99:this.rpnMode=!1;this.NrpnMsb[b]=d;break;case 100:this.rpnMode=!0;this.RpnLsb[b]=d;break;case 101:this.rpnMode=!0;this.RpnMsb[b]=d;break;case 64:c.hold(b,d);break;case 11:c.expression(b,d);break;case 72:c.decayTime(b,d);break;case 73:c.releaseTime(b,d);break;case 74:c.attackTime(b,d);break;case 75:c.cutOffFrequency(b,d);break;case 91:c.reverbDepth(b,
d)}break;case 192:c.programChange(b,a[1]);break;case 224:c.pitchBend(b,a[1],a[2]);break;case 240:switch(a[1]){case 126:127===a[2]&&9===a[3]&&1===a[4]&&c.init("GM");break;case 127:switch(a[3]){case 4:switch(a[4]){case 1:c.setMasterVolume(a[5]+(a[6]<<7))}}}switch(a[2]){case 67:8===a[5]&&(0!==a[7]?c.setPercussionPart(a[6],!0):c.setPercussionPart(a[6],!1));switch(a[7]){case 4:c.setMasterVolume(2*(a[8]<<7));break;case 126:c.init("XG"),console.log("XG Reset")}break;case 65:switch(a[8]){case 4:c.setMasterVolume(a[9]<<
7);break;case 127:c.init("GS");console.log("GS Reset");break;case 21:b=a[7]-15,a=a[8],0===b?0!==a?c.setPercussionPart(9,!0):c.setPercussionPart(9,!1):10<=b?0!==a?c.setPercussionPart(b-1,!0):c.setPercussionPart(b-1,!1):0!==a?c.setPercussionPart(b,!0):c.setPercussionPart(b,!1)}}break;default:c.setPercussionPart(9,!0)}}}l["default"]=d}])});}).call(this || window)

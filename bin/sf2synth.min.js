/** @license sf2synth.js 2013 - imaya / GREE Inc. [ https://github.com/gree/sf2synth.js ], 2013-2018 - Logue [ https://github.com/logue/sf2synth.js ] The MIT License */(function() {'use strict';var m,r=this;
function v(b){var a=typeof b;if("object"==a)if(b){if(b instanceof Array)return"array";if(b instanceof Object)return a;var c=Object.prototype.toString.call(b);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof b.length&&"undefined"!=typeof b.splice&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof b.call&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
a&&"undefined"==typeof b.call)return"object";return a}function w(b,a){b=b.split(".");var c=r;b[0]in c||!c.execScript||c.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)b.length||void 0===a?c[e]?c=c[e]:c=c[e]={}:c[e]=a};function A(b,a,c){this.a=b;this.m=a;this.o=c;this.key=c.key;this.G=c.velocity;this.l=c.sample;this.h=c.basePlaybackRate;this.sampleRate=c.sampleRate;this.volume=c.volume;this.v=c.panpot;this.s=c.pitchBend;this.B=c.pitchBendSensitivity;this.F=c.modEnvToPitch;this.g=c.expression;this.C=b.currentTime;this.c=this.h|0;this.j=!1}function B(b){return 440*Math.pow(2,(b-6900)/1200)}
function C(b){var a=b.o,c=b.i,e=b.f,d=b.a.currentTime,f=a.releaseTime-64;f=d+a.volRelease*e.gain.value*(1+f/(0>f?64:63));var g=b.K,h=B(a.initialFilterFc),k=B(a.initialFilterFc+a.modEnvToFilterFc);k=d+a.modRelease*(h===k?1:(g.frequency.value-h)/(k-h));if(b.D)switch(a.sampleModes){case 1:e.gain.cancelScheduledValues(0);e.gain.setValueAtTime(e.gain.value,d);e.gain.linearRampToValueAtTime(0,f);g.frequency.cancelScheduledValues(0);g.frequency.setValueAtTime(g.frequency.value,d);g.frequency.linearRampToValueAtTime(h,
k);c.playbackRate.cancelScheduledValues(0);c.playbackRate.setValueAtTime(c.playbackRate.value,d);c.playbackRate.linearRampToValueAtTime(b.c,k);c.stop(f);break;case 2:r.console.log("detect unused sampleModes");break;case 3:c.loop=!1}}A.prototype.connect=function(){this.f.connect(this.m)};A.prototype.disconnect=function(){this.f.disconnect(0)};
function D(b,a){b.c=b.h*Math.pow(Math.pow(2,1/12),a/(0>a?8192:8191)*b.B*b.o.scaleTuning);a=b.i.playbackRate;var c=b.c,e=b.C,d=b.o,f=e+d.modAttack,g=f+d.modDecay;b=c*Math.pow(Math.pow(2,1/12),b.F*b.o.scaleTuning);a.cancelScheduledValues(0);a.setValueAtTime(c,e);a.linearRampToValueAtTime(b,f);a.linearRampToValueAtTime(c+(b-c)*(1-d.modSustain),g)};function I(b,a){a=a||{};this.input=b;this.b=a.index||0;this.length=a.length||b.length-this.b;this.offset=this.b;this.c=void 0!==a.padding?a.padding:!0;this.f=void 0!==a.bigEndian?a.bigEndian:!1}function aa(b,a,c){this.type=b;this.a=a;this.offset=c}
I.prototype.parse=function(){var b=this.length+this.offset;for(this.a=[];this.b<b;){var a=this.input;var c=this.b;this.a.push(new aa(String.fromCharCode(a[c++],a[c++],a[c++],a[c++]),a=this.f?(a[c++]<<24|a[c++]<<16|a[c++]<<8|a[c++])>>>0:(a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0,c));c+=a;this.c&&1===(c-this.offset&1)&&c++;this.b=c}};function K(b,a){b=b.a[a];return void 0===b?null:b};function L(b,a){a=a||{};this.input=b;this.ua=a.parserOption;this.sampleRate=a.sampleRate||22050}
L.prototype.parse=function(){var b,a=new I(this.input,this.ua);a.parse();if(1!==a.a.length)throw Error("wrong chunk length");a=K(a,0);if(null===a)throw Error("chunk not found");var c=this.input,e=a.offset;if("RIFF"!==a.type)throw Error("invalid chunk type:"+a.type);var d=String.fromCharCode(c[e++],c[e++],c[e++],c[e++]);if("sfbk"!==d)throw Error("invalid signature:"+d);a=new I(c,{index:e,length:a.a-4});a.parse();if(3!==a.a.length)throw Error("invalid sfbk structure");c=K(a,0);e=this.input;d=c.offset;
if("LIST"!==c.type)throw Error("invalid chunk type:"+c.type);var f=String.fromCharCode(e[d++],e[d++],e[d++],e[d++]);if("INFO"!==f)throw Error("invalid signature:"+f);(new I(e,{index:d,length:c.a-4})).parse();c=K(a,1);e=this.input;d=c.offset;if("LIST"!==c.type)throw Error("invalid chunk type:"+c.type);f=String.fromCharCode(e[d++],e[d++],e[d++],e[d++]);if("sdta"!==f)throw Error("invalid signature:"+f);c=new I(e,{index:d,length:c.a-4});c.parse();if(1!==c.a.length)throw Error("TODO");this.ja=K(c,0);a=
K(a,2);c=this.input;e=a.offset;if("LIST"!==a.type)throw Error("invalid chunk type:"+a.type);d=String.fromCharCode(c[e++],c[e++],c[e++],c[e++]);if("pdta"!==d)throw Error("invalid signature:"+d);a=new I(c,{index:e,length:a.a-4});a.parse();if(9!==a.a.length)throw Error("invalid pdta chunk");c=K(a,0);e=this.input;d=c.offset;f=this.xa=[];var g=c.offset+c.a;if("phdr"!==c.type)throw Error("invalid chunk type:"+c.type);for(;d<g;)f.push({ya:String.fromCharCode.apply(null,e.subarray(d,d+=20)),wa:e[d++]|e[d++]<<
8,X:e[d++]|e[d++]<<8,fa:e[d++]|e[d++]<<8,Ha:(e[d++]|e[d++]<<8|e[d++]<<16|e[d++]<<24)>>>0,Ga:(e[d++]|e[d++]<<8|e[d++]<<16|e[d++]<<24)>>>0,Ia:(e[d++]|e[d++]<<8|e[d++]<<16|e[d++]<<24)>>>0});c=K(a,1);e=this.input;d=c.offset;f=this.za=[];g=c.offset+c.a;if("pbag"!==c.type)throw Error("invalid chunk type:"+c.type);for(;d<g;)f.push({ga:e[d++]|e[d++]<<8,L:e[d++]|e[d++]<<8});c=K(a,2);if("pmod"!==c.type)throw Error("invalid chunk type:"+c.type);this.ia=M(this,c);c=K(a,3);if("pgen"!==c.type)throw Error("invalid chunk type:"+
c.type);this.ha=ba(this,c);c=K(a,4);e=this.input;d=c.offset;f=this.o=[];g=c.offset+c.a;if("inst"!==c.type)throw Error("invalid chunk type:"+c.type);for(;d<g;)f.push({qa:String.fromCharCode.apply(null,e.subarray(d,d+=20)),aa:e[d++]|e[d++]<<8});c=K(a,5);e=this.input;d=c.offset;f=this.ra=[];g=c.offset+c.a;if("ibag"!==c.type)throw Error("invalid chunk type:"+c.type);for(;d<g;)f.push({ba:e[d++]|e[d++]<<8,pa:e[d++]|e[d++]<<8});c=K(a,6);if("imod"!==c.type)throw Error("invalid chunk type:"+c.type);this.da=
M(this,c);c=K(a,7);if("igen"!==c.type)throw Error("invalid chunk type:"+c.type);this.ca=ba(this,c);g=K(a,8);a=this.input;c=g.offset;e=this.Aa=[];d=this.Ba=[];f=g.offset+g.a;if("shdr"!==g.type)throw Error("invalid chunk type:"+g.type);for(;c<f;){g=String.fromCharCode.apply(null,a.subarray(c,c+=20));var h=(a[c++]<<0|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0;var k=(a[c++]<<0|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0;var n=(a[c++]<<0|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0;var p=(a[c++]<<0|a[c++]<<8|a[c++]<<16|a[c++]<<
24)>>>0;var q=(a[c++]<<0|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0;var x=a[c++];var t=a[c++]<<24>>24;var E=a[c++]|a[c++]<<8;var z=a[c++]|a[c++]<<8;var l=new Int16Array((new Uint8Array(a.subarray(this.ja.offset+2*h,this.ja.offset+2*k))).buffer);n-=h;p-=h;if(0<q){var F,u=l,y=q;for(b=1;y<this.sampleRate;){var H=new Int16Array(2*u.length);var G=l=0;for(F=u.length;G<F;++G)H[l++]=u[G],H[l++]=u[G];u=H;b*=2;y*=2}l=u;q*=b;n*=b;p*=b}e.push(l);d.push({La:g,start:h,end:k,Ea:n,na:p,sampleRate:q,ta:x,va:t,Ka:E,Ma:z})}this.input=
null};function M(b,a){b=b.input;var c=a.offset;a=a.offset+a.a;for(var e,d,f=[];c<a;){c+=2;e=b[c++]|b[c++]<<8;d=ca[e];if(void 0===d)f.push({type:d,value:{code:e,u:b[c]|b[c+1]<<8<<16>>16,A:b[c++],w:b[c++]}});else switch(d){case "keyRange":case "velRange":case "keynum":case "velocity":f.push({type:d,value:{A:b[c++],w:b[c++]}});break;default:f.push({type:d,value:{u:b[c++]|b[c++]<<8<<16>>16}})}c+=2;c+=2}return f}
function ba(b,a){b=b.input;var c=a.offset;a=a.offset+a.a;for(var e,d,f=[];c<a;)if(e=b[c++]|b[c++]<<8,d=ca[e],void 0===d)f.push({type:d,value:{code:e,u:b[c]|b[c+1]<<8<<16>>16,A:b[c++],w:b[c++]}});else switch(d){case "keynum":case "keyRange":case "velRange":case "velocity":f.push({type:d,value:{A:b[c++],w:b[c++]}});break;default:f.push({type:d,value:{u:b[c++]|b[c++]<<8<<16>>16}})}return f}
function N(b,a,c){var e=[],d={Fa:[],keyRange:{w:127,A:0}},f;for(f=b;f<a;++f)b=c[f],e.push(b),"unknown"===b.type?d.Fa.push(b.value):d[b.type]=b.value;return{I:d,J:e}}
var ca=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend","pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay",
"delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",,"scaleTuning","exclusiveClass","overridingRootKey","endOper"];function da(b){this.a=b;this.node=this.a.createGain();this.b=this.node.Ja=this.a.createGain();this.j=this.a.createGain();this.i=this.a.createGain();this.h=this.a.createConvolver();this.c=this.a.createBiquadFilter();this.f=350;this.l="lowpass";this.m=.5;this.g=!1;this.s=3;this.b.connect(this.i);this.b.connect(this.j);this.h.connect(this.c);this.i.connect(this.b);this.j.connect(this.h);this.c.connect(this.b);for(var a in void 0)void 0!==(void 0)[a]&&(this["_"+a]=(void 0)[a]);this.m=b=this.m;this.i.gain.setTargetAtTime((1<
b||0>b?0:.5>=b?1:1-2*(b-.5))/127,this.a.currentTime,.015);this.j.gain.setTargetAtTime((1<b||0>b?0:.5<=b?1:1-2*(b-.5))/127,this.a.currentTime,.015);this.c.type=this.l=this.l;this.f=this.f;this.c.frequency.setTargetAtTime(this.f,this.a.currentTime,.015);O(this)}m=da.prototype;m.node=function(){return this.b};
function O(b){var a=b.a.sampleRate,c=Math.max(a*b.s,1),e=0*a;a=b.a.createBuffer(2,c,a);for(var d=new Float32Array(c),f=new Float32Array(c),g=0;g<c;g++){if(g<e)d[g]=0,f[g]=0;else{var h=b.g?c-g:g;h=Math.pow(1-h/c,2);d[g]=(2*Math.random()-1)*h;f[g]=(2*Math.random()-1)*h}h=b.g?c-(g-e):g-e;h=Math.pow(1-h/c,2);d[g]=(2*Math.random()-1)*h;f[g]=(2*Math.random()-1)*h}a.getChannelData(0).set(d);a.getChannelData(1).set(f);console.info("Update impulse responce.");b.h.buffer=a}
m.connect=function(b){r.console.info("Connect Reverb.");this.b.connect(b)};m.disconnect=function(b){r.console.info("Disconnect Reverb.");this.b.disconnect(b)};m.time=function(b){this.s=b;O(this)};m.reverse=function(b){this.g=b;O(this)};var ea="Acoustic Piano;Bright Acoustic Piano;Electric Grand Piano;Honky-tonk Piano;Electric Piano;Electric Piano 2;Harpsichord;Clavi;Celesta;Glockenspiel;Musical box;Vibraphone;Marimba;Xylophone;Tubular Bell;Dulcimer;Drawbar Organ;Percussive Organ;Rock Organ;Church organ;Reed organ;Accordion;Harmonica;Tango Accordion;Acoustic Guitar (nylon);Acoustic Guitar (steel);Electric Guitar (jazz);Electric Guitar (clean);Electric Guitar (muted);Overdriven Guitar;Distortion Guitar;Guitar Harmonics;Acoustic Bass;Electric Bass (finger);Electric Bass (pick);Fretless Bass;Slap Bass 1;Slap Bass 2;Synth Bass 1;Synth Bass 2;Violin;Viola;Cello;Double bass;Tremolo Strings;Pizzicato Strings;Orchestral Harp;Timpani;String Ensemble 1;String Ensemble 2;Synth Strings 1;Synth Strings 2;Voice Aahs;Voice Oohs;Synth Voice;Orchestra Hit;Trumpet;Trombone;Tuba;Muted Trumpet;French horn;Brass Section;Synth Brass 1;Synth Brass 2;Soprano Sax;Alto Sax;Tenor Sax;Baritone Sax;Oboe;English Horn;Bassoon;Clarinet;Piccolo;Flute;Recorder;Pan Flute;Blown Bottle;Shakuhachi;Whistle;Ocarina;Lead 1 (square);Lead 2 (sawtooth);Lead 3 (calliope);Lead 4 (chiff);Lead 5 (charang);Lead 6 (voice);Lead 7 (fifths);Lead 8 (bass + lead);Pad 1 (new age);Pad 2 (warm);Pad 3 (polysynth);Pad 4 (choir);Pad 5 (bowed);Pad 6 (metallic);Pad 7 (halo);Pad 8 (sweep);FX 1 (rain);FX 2 (soundtrack);FX 3 (crystal);FX 4 (atmosphere);FX 5 (brightness);FX 6 (goblins);FX 7 (echoes);FX 8 (sci-fi);Sitar;Banjo;Shamisen;Koto;Kalimba;Bagpipe;Fiddle;Shanai;Tinkle Bell;Agogo;Steel Drums;Woodblock;Taiko Drum;Melodic Tom;Synth Drum;Reverse Cymbal;Guitar Fret Noise;Breath Noise;Seashore;Bird Tweet;Telephone Ring;Helicopter;Applause;Gunshot".split(";"),
fa=["Standard Set",null,null,null,null,null,null,null,"Room Set",null,null,null,null,null,null,null,"Power Set",null,null,null,null,null,null,null,"Electronic Set","Analog Set",null,null,null,null,null,null,"Jazz Set",null,null,null,null,null,null,null,"Brush Set",null,null,null,null,null,null,null,"Orchestra Set",null,null,null,null,null,null,null,"SFX Set",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,
null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];function P(b){var a;this.input=b;this.v={};this.X=0;this.l={};if(void 0!==r.AudioContext)b=new r.AudioContext;else if(void 0!==r.webkitAudioContext)b=new r.webkitAudioContext;else if(void 0!==r.mozAudioContext)b=new r.mozAudioContext;else throw Error("Web Audio not supported");void 0===b.createGainNode&&(b.createGainNode=b.createGain);this.b=b;this.h=this.b.createGain();this.B=this.b.createBufferSource();this.c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.S=[127,127,127,127,127,127,127,127,127,127,127,
127,127,127,127,127];this.O=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.F=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2];this.C=[127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127];this.R=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.D=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];this.g=[0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0];this.M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.V=[40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40];this.U=[64,64,
64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.G=[64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];this.i=this.m=!1;this.N=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];this.f=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];this.ka=1/65535;this.a=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];this.j=Array(128);b=0;for(a=this.j.length;b<a;++b)this.j[b]=127;this.W=!0;this.s=new da(this.b)}
function Q(b){var a;b.v=new L(b.input,{sampleRate:b.b.sampleRate});b.l=ha(b);b.i=!1;b.m=!1;for(a=0;16>a;++a)R(b,a,0),la(b,a,100),ma(b,a,64),S(b,a,0,64),T(b,a,2),b.D[a]=!1,b.C[a]=127,b.g[a]=9===a?128:0,b.M[a]=0,b.a[a]=!1,b.V[a]=40;for(a=0;128>a;++a)b.j[a]=127}P.prototype.close=function(){this.b.close()};
function ha(b){b=b.v;b.parse();var a=b.xa,c=b.za,e=[],d,f;var g=0;for(f=a.length;g<f;++g){var h=a[g].fa;var k=a[g+1]?a[g+1].fa:c.length;for(d=[];h<k;++h){var n=N(c[h].ga,c[h+1]?c[h+1].ga:b.ha.length,b.ha);var p=n.I;var q=n.J;var x=N(c[h].L,c[h+1]?c[h+1].L:b.ia.length,b.ia);n=x.I;x=x.J;d.push({Z:p,oa:q,K:n,sa:x});p=void 0!==p.instrument?p.instrument.u:void 0!==n.instrument?n.instrument.u:null}e.push({name:a[g].ya,info:d,$:a[g],o:p})}c=b.o;d=b.ra;a=[];f=0;for(h=c.length;f<h;++f){k=c[f].aa;p=c[f+1]?
c[f+1].aa:d.length;g=[];for(n=p;k<n;++k){q=N(d[k].ba,d[k+1]?d[k+1].ba:b.ca.length,b.ca);p=q.I;x=q.J;var t=N(d[k].L,d[k+1]?d[k+1].pa:b.da.length,b.da);q=t.I;t=t.J;g.push({Z:p,oa:x,K:q,sa:t})}a.push({name:c[f].qa,info:g})}c=[];f=0;for(h=e.length;f<h;++f)if(p=e[f],g=p.$.wa,k=p.$.X,"number"==typeof p.o&&(d=a[p.o],"EOI"!==d.name.replace(/\0*$/,"")))for(void 0===c[k]&&(c[k]=[]),k=c[k],k[g]={},k[g].name=p.name,p=0,n=d.info.length;p<n;++p){var E=b,z=k[g],l=d.info[p].Z;if(void 0!==l.keyRange&&void 0!==l.sampleID){var F=
U(l,"delayVolEnv",-12E3);var u=U(l,"attackVolEnv",-12E3);var y=U(l,"holdVolEnv",-12E3);var H=U(l,"decayVolEnv",-12E3);var G=U(l,"sustainVolEnv");var ta=U(l,"releaseVolEnv",-12E3);var ua=U(l,"delayModEnv",-12E3);var va=U(l,"attackModEnv",-12E3);var wa=U(l,"holdModEnv",-12E3);var xa=U(l,"decayModEnv",-12E3);var ya=U(l,"sustainModEnv");var za=U(l,"releaseModEnv",-12E3);var Aa=U(l,"coarseTune")+U(l,"fineTune")/100;var ia=U(l,"scaleTuning",100)/100;var ja=U(l,"freqVibLFO");q=U(l,"pan");t=l.keyRange.A;
for(x=l.keyRange.w;t<=x;++t)if(!z[t]){var ka=U(l,"sampleID");var J=E.Ba[ka];z[t]={sample:E.Aa[ka],sampleRate:J.sampleRate,sampleModes:U(l,"sampleModes"),basePlaybackRate:Math.pow(Math.pow(2,1/12),(t-U(l,"overridingRootKey",J.ta)+Aa+J.va/100)*ia),modEnvToPitch:U(l,"modEnvToPitch")/100,scaleTuning:ia,start:32768*U(l,"startAddrsCoarseOffset")+U(l,"startAddrsOffset"),end:32768*U(l,"endAddrsCoarseOffset")+U(l,"endAddrsOffset"),loopStart:J.Ea+32768*U(l,"startloopAddrsCoarseOffset")+U(l,"startloopAddrsOffset"),
loopEnd:J.na+32768*U(l,"endloopAddrsCoarseOffset")+U(l,"endloopAddrsOffset"),volDelay:Math.pow(2,F/1200),volAttack:Math.pow(2,u/1200),volHold:Math.pow(2,y/1200)*Math.pow(2,(60-t)*U(l,"keynumToVolEnvHold")/1200),volDecay:Math.pow(2,H/1200)*Math.pow(2,(60-t)*U(l,"keynumToVolEnvDecay")/1200),volSustain:G/1E3,volRelease:Math.pow(2,ta/1200),modDelay:Math.pow(2,ua/1200),modAttack:Math.pow(2,va/1200),modHold:Math.pow(2,wa/1200)*Math.pow(2,(60-t)*U(l,"keynumToModEnvHold")/1200),modDecay:Math.pow(2,xa/1200)*
Math.pow(2,(60-t)*U(l,"keynumToModEnvDecay")/1200),modSustain:ya/1E3,modRelease:Math.pow(2,za/1200),initialFilterFc:U(l,"initialFilterFc",13500),modEnvToFilterFc:U(l,"modEnvToFilterFc"),initialFilterQ:U(l,"initialFilterQ"),reverbEffectSend:U(l,"reverbEffectSend"),initialAttenuation:U(l,"initialAttenuation"),freqVibLFO:ja?8.176*Math.pow(2,ja/1200):void 0,pan:q?q/1200:void 0}}}}return c}function U(b,a,c){void 0===c&&(c=0);return b[a]?b[a].u:c}
P.prototype.start=function(){this.connect();V(this,16383);this.B.start(0)};function V(b,a){b.h.gain.setTargetAtTime(a/16384*b.ka,b.b.currentTime,.015)}P.prototype.connect=function(){this.B.connect(this.h);this.h.connect(this.b.destination);na(this,this.W)};P.prototype.disconnect=function(){this.B.disconnect(0);this.h.disconnect(0);this.s.disconnect(0)};function na(b,a){b.s.disconnect(0);if(b.W=a)b.h.connect(b.s.node),b.s.connect(b.b.destination)}var W="Instrument Vol Pan Bend Range Mode".split(" ");
function oa(b){var a=r.window.document,c=b.table=a.createElement("table"),e=a.createElement("thead"),d=a.createElement("tbody"),f;e.appendChild(pa(W,!0));for(f=0;16>f;++f){var g=pa(W.length+128,!1);d.appendChild(g);var h=g.querySelector("td:nth-child(1)");var k=a.createElement("input");k.setAttribute("type","checkbox");k.addEventListener("change",function(b,c){return function(){var a=this.checked,d=b.f[c],e;if(b.N[c]=a)for(a=0,e=d.length;a<e;++a)d[a].disconnect();else for(a=0,e=d.length;a<e;++a)d[a].connect()}}(b,
f),!1);h.appendChild(k);var n=a.createElement("select");for(k=0;128>k;++k){var p=9!==f?ea[k]:fa[k];var q=a.createElement("option");p&&(q.textContent=p,q.value=k,n.appendChild(q))}h.appendChild(n);n.addEventListener("change",function(a,b){return function(c){R(a,b,c.target.value)}}(b,f),!1);n.selectedIndex=b.c[f];h=a.createElement("meter");h.min=0;h.max=127;h.value=64;h.textContent=64;g.querySelector("td:nth-child(3)").appendChild(h);h=a.createElement("meter");h.min=-8192;h.max=8192;h.value=0;h.textContent=
0;g.querySelector("td:nth-child(4)").appendChild(h);g=g.querySelectorAll("td:nth-last-child(-n+128)");for(k=0;128>k;++k)g[k].addEventListener("mousedown",function(a,b,c){return function(d){d.preventDefault();a.T=!0;X(a,b,c,127)}}(b,f,k)),g[k].addEventListener("mouseover",function(a,b,c){return function(d){d.preventDefault();a.T&&X(a,b,c,127)}}(b,f,k)),g[k].addEventListener("mouseout",function(a,b,c){return function(d){d.preventDefault();Y(a,b,c)}}(b,f,k)),g[k].addEventListener("mouseup",function(a,
b,c){return function(d){d.preventDefault();a.T=!1;Y(a,b,c)}}(b,f,k))}c.appendChild(e);c.appendChild(d);return c}function pa(b,a){var c=r.window.document,e=c.createElement("tr"),d=b instanceof Array,f,g=d?b.length:b;for(f=0;f<g;++f){var h=c.createElement(a?"th":"td");h.textContent=d&&void 0!==b[f]?b[f]:"";a&&g===f+1&&h.setAttribute("colspan",129);e.appendChild(h)}return e}
function X(b,a,c,e){var d=qa(b,a),f=b.l[d][b.c[a]];void 0===f&&(f=b.l[0][b.c[a]],r.console.warn("instrument not found: bank=%s instrument=%s channel=%s",d,b.c[a],a));if(void 0===f[c])r.console.warn("instrument not found: bank=%s instrument=%s channel=%s key=%s",d,b.c[a],a,c);else{d=f[c];var g=b.O[a]-64;d.channel=a;d.key=c;d.velocity=e;d.panpot=g/(0>g?64:63);d.volume=b.S[a]/127;d.pitchBend=b.P[a]-8192;d.expression=b.C[a];d.pitchBendSensitivity=Math.round(b.F[a]);d.mute=b.N[a];d.releaseTime=b.R[a];
d.cutOffFrequency=b.G[a];d.harmonicContent=b.U[a];b.a[a]&&(42!==c&&44!==c||Y(b,a,46),80===c&&Y(b,a,81),f.volume*=b.j[c]/127);f=new A(b.b,b.h,d);var h=f.a;d=f.o;var k=f.l;g=f.a.currentTime;var n=g+d.volDelay,p=g+d.modDelay,q=n+d.volAttack+d.volHold,x=n+d.modAttack+d.modHold,t=q+d.volDecay,E=x+d.modDecay;var z=d.loopStart/f.sampleRate;var l=d.loopEnd/f.sampleRate;var F=d.start/f.sampleRate;var u=void 0!==d.pan?d.pan:f.v;k=k.subarray(0,k.length+d.end);var y=f.D=h.createBuffer(1,k.length,f.sampleRate);
y.getChannelData(0).set(k);k=f.i=h.createBufferSource();k.buffer=y;k.loop=1===(d.sampleModes&1);k.loopStart=z;k.loopEnd=l;D(f,f.s);z=f.f=h.createGain();l=z.gain;f.b=h.createGain();f.b.gain.setTargetAtTime(f.g/127,f.a.currentTime,.015);y=h.createPanner();y.panningModel="equalpower";y.setPosition(Math.sin(u*Math.PI/2),0,Math.cos(u*Math.PI/2));u=f.G/127*f.volume*(1-d.initialAttenuation/1E3);0>u&&(u=0);l.setValueAtTime(0,g);l.setValueAtTime(0,n);l.setTargetAtTime(u,n,d.volAttack);l.setValueAtTime(u,q);
l.linearRampToValueAtTime(u*(1-d.volSustain),t);n=B(d.initialFilterFc);q=B(d.initialFilterFc+d.modEnvToFilterFc);t=n+(q-n)*(1-d.modSustain);h=f.K=h.createBiquadFilter();h.Q.setValueAtTime(Math.pow(10,d.initialFilterQ/200),g);h.frequency.setTargetAtTime(n/127,f.a.currentTime,.5);h.type="lowpass";h.frequency.setValueAtTime(n,g);h.frequency.setValueAtTime(n,p);h.frequency.setTargetAtTime(q,p,parseFloat(d.modAttack+1));h.frequency.setValueAtTime(q,x);h.frequency.linearRampToValueAtTime(t,E);k.connect(h);
h.connect(y);y.connect(f.b);f.b.connect(z);d.mute||f.connect();k.start(0,F);b.f[a].push(f);ra(b,a,c,e)}}function Y(b,a,c){qa(b,a);var e,d=b.f[a];var f=0;for(e=d.length;f<e;++f){var g=d[f];g.key===c&&(g.j=!0,C(g),d.splice(f,1),--f,--e)}ra(b,a,c,0)}
function ra(b,a,c,e){b.table&&(c=b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child("+(c+W.length+1)+")"),0===e?(c.classList.remove("note-on"),c.style.opacity=1):(c.classList.add("note-on"),c.style.opacity=(e/127).toFixed(2)),b.D[a]?b.table.querySelector("tbody > tr:nth-child("+(a+1)+")").classList.add("hold"):b.table.querySelector("tbody > tr:nth-child("+(a+1)+")").classList.remove("hold"))}
function sa(b,a){var c=b.f[a];b.D[a]=!0;var e;a=0;for(e=c.length;a<e;++a)b=c[a],b.j&&(C(b),c.splice(a,1),--a,--e)}function R(b,a,c){b.table&&(b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:first-child > select").value=c);b.c[a]=c}function la(b,a,c){b.table&&(b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(2)").textContent=c);b.S[a]=c}
function Ba(b,a,c){var e,d=b.f[a];var f=0;for(e=d.length;f<e;++f){var g=d[f];g.b.gain.setTargetAtTime((g.g=c)/127,g.a.currentTime,.015)}b.C[a]=c}function ma(b,a,c){b.table&&(b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(3) > meter").value=c);b.O[a]=c}function S(b,a,c,e){c=c&127|(e&127)<<7;var d,f=b.f[a],g=c-8192;b.table&&(b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(4) > meter").value=g);e=0;for(d=f.length;e<d;++e)D(f[e],g);b.P[a]=c}
function T(b,a,c){b.table&&(b.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(5)").textContent=c);b.F[a]=c}function qa(b,a){var c="GM Mode";if(9===a)return b.a[9]=!0,b.i?127:128;if(b.i){c="XG Mode";var e=64===b.g[a]?125:126===b.g[a]||127===b.g[a]?b.g[a]:0}else b.m?(c="GS Mode",e=0,b.a[a]&&(e=128)):e=0;b.a[a]&&void 0===fa[b.c[a]]&&(b.c[a]=0);b.table.querySelector("thead tr:first-child > th:nth-child(6)").innerText=c;return e};function Z(b){this.j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.l=!1;this.h=function(){};this.m=this.la.bind(this);this.a=!0;this.Y=void 0!==b.Y;this.cache=void 0!==b.cache;r.window.addEventListener("DOMContentLoaded",function(){this.l=!0}.bind(this),!1)}m=Z.prototype;
m.Da=function(b){var a=r.window;this.l?this.load(b):a.addEventListener("DOMContentLoaded",function e(){a.removeEventListener("DOMContentLoaded",e,!1);this.load(b)}.bind(this),!1)};
m.load=function(b){var a=r.window.opener?r.window.opener:r.window.parent;this.H();var c=this.c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType="arraybuffer";c.addEventListener("load",function(a){var b=new Uint8Array(a.target.response);this.ea(b);"function"==v(this.h)&&this.h(a.target.response);this.c=null}.bind(this),!1);c.addEventListener("abort",function(){this.H()}.bind(this),!1);c.addEventListener("progress",function(b){b.lengthComputable&&a&&a.postMessage("link,progress,"+b.loaded+","+b.total,
"*")}.bind(this),!1);c.addEventListener("fetch",function(){});c.send()};m.ma=function(b){na(this.b,b)};m.H=function(){this.c&&(this.c.abort(),this.c=null)};m.ea=function(b){var a=r.window;this.H();if(this.b){var c=this.b;c.input=b;c.v=new L(b);c.l=ha(c)}else c=this.b=new P(b),this.Y||a.document.body.appendChild(oa(c)),Q(c),c.start(),a.addEventListener("message",this.m,!1);a.postMessage("link,ready","*")};
m.la=function(b){var a="function"==v(b.data.split)?b.data.split(","):[],c=a!==[]?a.shift():"";b=r.window.opener?r.window.opener:r.window.parent;switch(c){case "midi":Ca(this,a.map(function(a){return parseInt(a,16)}));break;case "link":if(void 0!==b)switch(a=a.shift(),a){case "reqpatch":b.postMessage("link,patch","*");break;case "setpatch":case "ready":b.postMessage("link,ready","*");break;case "progress":b.postMessage("link,progress","*");break;default:r.console.error("unknown link message:",a)}}};
m.Ca=function(b){this.h=b};
function Ca(b,a){var c=a[0]&15,e=b.b;switch(a[0]&240){case 128:Y(e,c,a[1]);break;case 144:0<a[2]?X(e,c,a[1],a[2]):Y(e,c,a[1]);break;case 176:var d=a[2];switch(a[1]){case 0:e.g[c]=d;break;case 6:if(b.a)switch(b.g[c]){case 0:switch(b.f[c]){case 0:T(e,c,d)}}else switch(b.j[c]){case 26:e.j[b.i[c]]=d}break;case 38:if(b.a)switch(b.g[c]){case 0:switch(b.f[c]){case 0:T(e,c,e.F[c]+d/100)}}break;case 7:la(e,c,d);break;case 10:ma(e,c,d);break;case 120:for(a=e.f[c];0<a.length;)b=a.shift(),Y(e,c,b.key),C(b),b.disconnect();
sa(e,c);break;case 121:a=e.f[c];for(sa(e,c);0<a.length;)Y(e,c,a[0].key);Ba(e,c,127);S(e,c,0,64);break;case 32:e.M[c]=d;break;case 98:b.a=!1;b.i[c]=d;break;case 99:b.a=!1;b.j[c]=d;break;case 100:b.a=!0;b.f[c]=d;break;case 101:b.a=!0;b.g[c]=d;break;case 11:Ba(e,c,d);break;case 71:e.G[c]=d;break;case 73:e.R[c]=d;break;case 74:e.U[c]=d;break;case 91:e.V[c]=d}break;case 192:R(e,c,a[1]);break;case 224:S(e,c,a[1],a[2]);break;case 240:switch(a[1]){case 126:127===a[2]&&9===a[3]&&1===a[4]&&(e.i=!1,e.m=!1,Q(e));
break;case 127:switch(a[3]){case 4:switch(a[4]){case 1:V(e,a[5]+(a[6]<<7))}}}switch(a[2]){case 67:8===a[5]&&(e.a[a[6]]=0!==a[7]?!0:!1);switch(a[7]){case 4:V(e,2*(a[8]<<7));break;case 126:Q(e),e.i=!0}break;case 65:switch(a[8]){case 4:V(e,a[9]<<7);break;case 127:Q(e);e.m=!0;break;case 21:c=a[7]-15,a=a[8],0===c?e.a[9]=0!==a?!0:!1:10<=c?e.a[c-1]=0!==a?!0:!1:e.a[c]=0!==a?!0:!1}}break;default:e.a[9]=!0}};w("SoundFont.WebMidiLink",Z);w("SoundFont.WebMidiLink.prototype.setup",Z.prototype.Da);w("SoundFont.WebMidiLink.prototype.loadSoundFont",Z.prototype.ea);w("SoundFont.WebMidiLink.prototype.cancelLoading",Z.prototype.H);w("SoundFont.WebMidiLink.prototype.setLoadCallback",Z.prototype.Ca);w("SoundFont.WebMidiLink.prototype.setReverb",Z.prototype.ma);}).call(this); //# sourceMappingURL=sf2synth.min.js.map

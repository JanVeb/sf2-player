/*! sf2synth.js | imaya / GREE Inc. / Logue | license: MIT */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SoundFont",[],t):"object"==typeof exports?exports.SoundFont=t():e.SoundFont=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class n{constructor(e,t={}){this.input=e,this.ip=t.index||0,this.length=t.length||e.length-this.ip,this.chunkList,this.offset=this.ip,this.padding=void 0===t.padding||t.padding,this.bigEndian=void 0!==t.bigEndian&&t.bigEndian}parse(){let e=this.length+this.offset;for(this.chunkList=[];this.ip<e;)this.parseChunk()}parseChunk(){let e,t=this.input,r=this.ip;this.chunkList.push(new o(String.fromCharCode(t[r++],t[r++],t[r++],t[r++]),e=this.bigEndian?(t[r++]<<24|t[r++]<<16|t[r++]<<8|t[r++])>>>0:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0,r)),r+=e,this.padding&&1==(r-this.offset&1)&&r++,this.ip=r}getChunk(e){let t=this.chunkList[e];return void 0===t?null:t}getNumberOfChunks(){return this.chunkList.length}}class o{constructor(e,t,r){this.type=e,this.size=t,this.offset=r}}r.d(t,"Parser",function(){return s});class s{constructor(e,t={}){this.input=e,this.parserOption=t.parserOption,this.sampleRate=t.sampleRate||22050,this.presetHeader,this.presetZone,this.presetZoneModulator,this.presetZoneGenerator,this.instrument,this.instrumentZone,this.instrumentZoneModulator,this.instrumentZoneGenerator,this.sampleHeader,this.GeneratorEnumeratorTable=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend","pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay","delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",,"scaleTuning","exclusiveClass","overridingRootKey","endOper"]}parse(){let e,t=new n(this.input,this.parserOption);if(t.parse(),1!==t.chunkList.length)throw new Error("wrong chunk length");if(null===(e=t.getChunk(0)))throw new Error("chunk not found");this.parseRiffChunk(e),this.input=null}parseRiffChunk(e){let t,r,o=this.input,s=e.offset;if("RIFF"!==e.type)throw new Error("invalid chunk type:"+e.type);if("sfbk"!==(r=String.fromCharCode(o[s++],o[s++],o[s++],o[s++])))throw new Error("invalid signature:"+r);if((t=new n(o,{index:s,length:e.size-4})).parse(),3!==t.getNumberOfChunks())throw new Error("invalid sfbk structure");this.parseInfoList(t.getChunk(0)),this.parseSdtaList(t.getChunk(1)),this.parsePdtaList(t.getChunk(2))}parseInfoList(e){let t,r,o=this.input,s=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("INFO"!==(r=String.fromCharCode(o[s++],o[s++],o[s++],o[s++])))throw new Error("invalid signature:"+r);(t=new n(o,{index:s,length:e.size-4})).parse()}parseSdtaList(e){let t,r,o=this.input,s=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("sdta"!==(r=String.fromCharCode(o[s++],o[s++],o[s++],o[s++])))throw new Error("invalid signature:"+r);if((t=new n(o,{index:s,length:e.size-4})).parse(),1!==t.chunkList.length)throw new Error("TODO");this.samplingData=t.getChunk(0)}parsePdtaList(e){let t,r,o=this.input,s=e.offset;if("LIST"!==e.type)throw new Error("invalid chunk type:"+e.type);if("pdta"!==(r=String.fromCharCode(o[s++],o[s++],o[s++],o[s++])))throw new Error("invalid signature:"+r);if((t=new n(o,{index:s,length:e.size-4})).parse(),9!==t.getNumberOfChunks())throw new Error("invalid pdta chunk");this.parsePhdr(t.getChunk(0)),this.parsePbag(t.getChunk(1)),this.parsePmod(t.getChunk(2)),this.parsePgen(t.getChunk(3)),this.parseInst(t.getChunk(4)),this.parseIbag(t.getChunk(5)),this.parseImod(t.getChunk(6)),this.parseIgen(t.getChunk(7)),this.parseShdr(t.getChunk(8))}parsePhdr(e){let t=this.input,r=e.offset,n=this.presetHeader=[],o=e.offset+e.size;if("phdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<o;)n.push({presetName:String.fromCharCode.apply(null,t.subarray(r,r+=20)),preset:t[r++]|t[r++]<<8,bank:t[r++]|t[r++]<<8,presetBagIndex:t[r++]|t[r++]<<8,library:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0,genre:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0,morphology:(t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24)>>>0})}parsePbag(e){let t=this.input,r=e.offset,n=this.presetZone=[],o=e.offset+e.size;if("pbag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<o;)n.push({presetGeneratorIndex:t[r++]|t[r++]<<8,presetModulatorIndex:t[r++]|t[r++]<<8})}parsePmod(e){if("pmod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneModulator=this.parseModulator(e)}parsePgen(e){if("pgen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.presetZoneGenerator=this.parseGenerator(e)}parseInst(e){let t=this.input,r=e.offset,n=this.instrument=[],o=e.offset+e.size;if("inst"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<o;)n.push({instrumentName:String.fromCharCode.apply(null,t.subarray(r,r+=20)),instrumentBagIndex:t[r++]|t[r++]<<8})}parseIbag(e){let t=this.input,r=e.offset,n=this.instrumentZone=[],o=e.offset+e.size;if("ibag"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;r<o;)n.push({instrumentGeneratorIndex:t[r++]|t[r++]<<8,instrumentModulatorIndex:t[r++]|t[r++]<<8})}parseImod(e){if("imod"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneModulator=this.parseModulator(e)}parseIgen(e){if("igen"!==e.type)throw new Error("invalid chunk type:"+e.type);this.instrumentZoneGenerator=this.parseGenerator(e)}parseShdr(e){let t,r,n,o,s,i,a,u,h,l,p=this.input,d=e.offset,f=this.sample=[],m=this.sampleHeader=[],g=e.offset+e.size;if("shdr"!==e.type)throw new Error("invalid chunk type:"+e.type);for(;d<g;){t=String.fromCharCode.apply(null,p.subarray(d,d+=20)),r=(p[d++]<<0|p[d++]<<8|p[d++]<<16|p[d++]<<24)>>>0,n=(p[d++]<<0|p[d++]<<8|p[d++]<<16|p[d++]<<24)>>>0,o=(p[d++]<<0|p[d++]<<8|p[d++]<<16|p[d++]<<24)>>>0,s=(p[d++]<<0|p[d++]<<8|p[d++]<<16|p[d++]<<24)>>>0,i=(p[d++]<<0|p[d++]<<8|p[d++]<<16|p[d++]<<24)>>>0,a=p[d++],u=p[d++]<<24>>24,h=p[d++]|p[d++]<<8,l=p[d++]|p[d++]<<8;let e=new Int16Array(new Uint8Array(p.subarray(this.samplingData.offset+2*r,this.samplingData.offset+2*n)).buffer);if(o-=r,s-=r,i>0){let t=this.adjustSampleData(e,i);e=t.sample,i*=t.multiply,o*=t.multiply,s*=t.multiply}f.push(e),m.push({sampleName:t,start:r,end:n,startLoop:o,endLoop:s,sampleRate:i,originalPitch:a,pitchCorrection:u,sampleLink:h,sampleType:l})}}adjustSampleData(e,t){let r,n,o,s,i=1;for(;t<this.sampleRate;){for(r=new Int16Array(2*e.length),n=s=0,o=e.length;n<o;++n)r[s++]=e[n],r[s++]=e[n];e=r,i*=2,t*=2}return{sample:e,multiply:i}}parseModulator(e){let t,r,n=this.input,o=e.offset,s=e.offset+e.size,i=[];for(;o<s;){if(o+=2,t=n[o++]|n[o++]<<8,void 0===(r=this.GeneratorEnumeratorTable[t]))i.push({type:r,value:{code:t,amount:n[o]|n[o+1]<<8<<16>>16,lo:n[o++],hi:n[o++]}});else switch(r){case"keyRange":case"velRange":case"keynum":case"velocity":i.push({type:r,value:{lo:n[o++],hi:n[o++]}});break;default:i.push({type:r,value:{amount:n[o++]|n[o++]<<8<<16>>16}})}o+=2,o+=2}return i}parseGenerator(e){let t,r,n=this.input,o=e.offset,s=e.offset+e.size,i=[];for(;o<s;)if(t=n[o++]|n[o++]<<8,void 0!==(r=this.GeneratorEnumeratorTable[t]))switch(r){case"keynum":case"keyRange":case"velRange":case"velocity":i.push({type:r,value:{lo:n[o++],hi:n[o++]}});break;default:i.push({type:r,value:{amount:n[o++]|n[o++]<<8<<16>>16}})}else i.push({type:r,value:{code:t,amount:n[o]|n[o+1]<<8<<16>>16,lo:n[o++],hi:n[o++]}});return i}createInstrument(){let e,t,r,n,o,s,i,a,u,h=this.instrument,l=this.instrumentZone,p=[];for(s=0,i=h.length;s<i;++s){for(r=[],a=e=h[s].instrumentBagIndex,u=t=h[s+1]?h[s+1].instrumentBagIndex:l.length;a<u;++a)n=this.createInstrumentGenerator_(l,a),o=this.createInstrumentModulator_(l,a),r.push({generator:n.generator,generatorSequence:n.generatorInfo,modulator:o.modulator,modulatorSequence:o.modulatorInfo});p.push({name:h[s].instrumentName,info:r})}return p}createPreset(){let e,t,r,n,o,s,i,a,u,h,l=this.presetHeader,p=this.presetZone,d=[];for(i=0,a=l.length;i<a;++i){for(r=[],u=e=l[i].presetBagIndex,h=t=l[i+1]?l[i+1].presetBagIndex:p.length;u<h;++u)o=this.createPresetGenerator_(p,u),s=this.createPresetModulator_(p,u),r.push({generator:o.generator,generatorSequence:o.generatorInfo,modulator:s.modulator,modulatorSequence:s.modulatorInfo}),n=void 0!==o.generator.instrument?o.generator.instrument.amount:void 0!==s.modulator.instrument?s.modulator.instrument.amount:null;d.push({name:l[i].presetName,info:r,header:l[i],instrument:n})}return d}createInstrumentGenerator_(e,t){let r=this.createBagModGen_(e,e[t].instrumentGeneratorIndex,e[t+1]?e[t+1].instrumentGeneratorIndex:this.instrumentZoneGenerator.length,this.instrumentZoneGenerator);return{generator:r.modgen,generatorInfo:r.modgenInfo}}createInstrumentModulator_(e,t){let r=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].instrumentModulatorIndex:this.instrumentZoneModulator.length,this.instrumentZoneModulator);return{modulator:r.modgen,modulatorInfo:r.modgenInfo}}createPresetGenerator_(e,t){let r=this.createBagModGen_(e,e[t].presetGeneratorIndex,e[t+1]?e[t+1].presetGeneratorIndex:this.presetZoneGenerator.length,this.presetZoneGenerator);return{generator:r.modgen,generatorInfo:r.modgenInfo}}createPresetModulator_(e,t){let r=this.createBagModGen_(e,e[t].presetModulatorIndex,e[t+1]?e[t+1].presetModulatorIndex:this.presetZoneModulator.length,this.presetZoneModulator);return{modulator:r.modgen,modulatorInfo:r.modgenInfo}}createBagModGen_(e,t,r,n){let o,s,i,a=[],u={unknown:[],keyRange:{hi:127,lo:0}};for(s=t,i=r;s<i;++s)o=n[s],a.push(o),"unknown"===o.type?u.unknown.push(o.value):u[o.type]=o.value;return{modgen:u,modgenInfo:a}}}t.default=s}])});